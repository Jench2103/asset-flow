# GEMINI.md

This file provides guidance to Gemini when working with code in this repository.

**Note:** This document, like others in this repository, is initially generated by an AI assistant. All content requires careful review and validation by human developers.

## Project Overview

AssetFlow is a multi-platform personal asset allocation and investment tracking application. Platform priority: macOS (primary) → iOS → iPadOS.

**Tech Stack:**

- Swift with SwiftUI
- SwiftData for persistence
- Minimum targets: macOS 14.0+, iOS 17.0+, iPadOS 17.0+

## Build Commands

```bash
# Open project
open AssetFlow.xcodeproj

# Build from command line
xcodebuild -project AssetFlow.xcodeproj -scheme AssetFlow build

# Format code with swift-format
swift-format format --in-place --recursive --parallel .

# Lint code with swift-format
swift-format lint --strict --recursive --parallel .
```

## Architecture

**MVVM Pattern:**

- Models: SwiftData models with relationships
- Views: SwiftUI components
- ViewModels: Business logic (to be implemented)
- Services: Data operations (to be implemented)

**Data Model Relationships:**

```
Portfolio (1:Many) Asset (1:Many) Transaction
InvestmentPlan (currently standalone)
```

All models are registered in `AssetFlowApp.swift` in the `sharedModelContainer` Schema. When adding new models, update both the Schema and `Models/README.md`.

**Xcode Configuration:** When adding new files, features, or dependencies, remember to update Xcode project configuration as needed:

- Add new source files to appropriate targets
- Update `Info.plist` for permissions, capabilities, or app metadata
- Configure build settings for new frameworks or libraries
- Update scheme configurations for testing or deployment
- Add new resources to bundle targets
- Configure entitlements for platform-specific features

**Documentation Updates:** When making changes to the project, keep documentation current. **IMPORTANT: Always check and update relevant design documents.**

Design documents are located in `Documentation/`:

**Core Documentation:**

- `Architecture.md` - System design, MVVM pattern, layer responsibilities, data flow
- `DataModel.md` - Complete model reference, relationships, SwiftData configuration
- `DevelopmentGuide.md` - Setup, workflows, platform-specific development
- `CodeStyle.md` - Coding standards, conventions, formatting rules
- `TestingStrategy.md` - Testing approach, patterns, coverage goals

**Design Documentation:**

- `UserInterfaceDesign.md` - UI layouts, navigation, visual design, component patterns
- `BusinessLogic.md` - Business rules, calculations, workflows, validation logic
- `SecurityAndPrivacy.md` - Security measures, privacy principles, threat model
- `APIDesign.md` - External integrations, internal API patterns, import/export

**Update checklist by change type:**

| Change Type                 | Update These Documents                                                                       |
| --------------------------- | -------------------------------------------------------------------------------------------- |
| Add/modify SwiftData model  | `Models/README.md` (quick ref), `Documentation/DataModel.md` (full)                          |
| Change architecture pattern | `Documentation/Architecture.md`, this file                                                   |
| Add new layer/service       | `Documentation/Architecture.md`, `Documentation/APIDesign.md`                                |
| New build command/tool      | `Documentation/DevelopmentGuide.md`, this file                                               |
| Coding convention change    | `Documentation/CodeStyle.md`                                                                 |
| Testing approach change     | `Documentation/TestingStrategy.md`                                                           |
| New platform support        | `Documentation/Architecture.md`, `Documentation/DevelopmentGuide.md`                         |
| Dependency added            | `Documentation/Architecture.md`, `Documentation/DevelopmentGuide.md`                         |
| Design new screen/UI        | `Documentation/UserInterfaceDesign.md`                                                       |
| Add business rule/calc      | `Documentation/BusinessLogic.md`                                                             |
| Security/privacy change     | `Documentation/SecurityAndPrivacy.md`                                                        |
| API/integration added       | `Documentation/APIDesign.md`, `Documentation/SecurityAndPrivacy.md` (if data transmitted)    |
| Major feature (full design) | Multiple: `UserInterfaceDesign.md`, `BusinessLogic.md`, `DataModel.md`, `APIDesign.md`, etc. |

**Before completing any task:**

1. Review which documentation files are affected by your changes
1. Update the relevant documentation files
1. Ensure cross-references between documents remain accurate
1. Update code examples in documentation if APIs changed

**General documentation rules:**

- Add inline code documentation for public APIs and complex logic
- Document platform-specific implementations and requirements
- Keep model relationships diagrams current
- Update README.md for user-facing changes

**Markdown Formatting Conventions:**

- **Numbered Lists**: Always use `1.` for all items in ordered lists. Markdown renderers automatically number them correctly. This makes version control diffs cleaner when reordering items.
  ```markdown
  1. First item
  1. Second item
  1. Third item
  ```
- **Tables**: Do NOT manually adjust column widths or alignment. The `mdformat` pre-commit hook handles table formatting automatically. Focus on content, not spacing.

**Code Quality and Formatting:**

- **Pre-commit hooks** are configured but run **automatically only when committing**
- Developers can run formatting/linting manually: `pre-commit run --all-files`
- **Do NOT** run pre-commit automatically during development workflow
- Pre-commit hooks will auto-format and check code when `git commit` is executed
- If hooks fail, fix issues and commit again

## Critical Conventions

**Financial Data:**

- Always use `Decimal` for monetary values (never Float/Double)
- Default currency: "USD"
- Extensions in `Utilities/Extensions.swift` provide `.formatted(currency:)` and `.formattedPercentage()`

**File Headers (SwiftLint enforced):**

```swift
//
//  FileName.swift
//  AssetFlow
//
//  Created by [Name] on YYYY/MM/DD.
//
```

**Platform-Specific Code:**

```swift
#if os(macOS)
    // macOS-specific code
#endif

#if os(iOS)
    // iOS-specific code
#endif
```

## SwiftLint Key Rules

- Line length: 120 warning, 150 error
- Function body: 60 warning, 100 error
- **Custom rule: No `print()` statements** - use proper logging
- Force unwrapping generates warnings
- Sorted imports required

## Core Models

**Asset** - Individual investments (stocks, bonds, crypto, real estate, etc.)

- Links to Portfolio (optional) and Transactions (many)

**Portfolio** - Asset collections with target allocation

- `totalValue` computed property aggregates asset values
- `targetAllocation: [String: Decimal]?` stores percentages by asset type

**Transaction** - Financial operations (buy/sell/dividend/interest/etc.)

- Links to specific Asset

**InvestmentPlan** - Strategic goals with risk tolerance and status tracking

See `AssetFlow/Models/README.md` for comprehensive model documentation.

## SwiftData Notes

- Single shared `ModelContainer` injected at app root
- No manual save() calls needed - SwiftData handles persistence automatically
- `Item.swift` is legacy from template - remove after updating ContentView
